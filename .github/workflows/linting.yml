name: Linting

on: [push, pull_request]

jobs:
  shellcheck:
    name: shellcheck
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Run shellcheck
      run: |
        find tests/CI -name '*.sh' -print0 | xargs -0 -n1 shellcheck --external-sources

  pytest:
    name: pytest
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Prepare environment
      run: |
        conda create --yes --name dirac-testing python=2.7
    - name: Run pytest
      run: |
        source "${CONDA}/bin/activate"
        conda activate dirac-testing
        export PYTHONPATH=${PWD%/*}
        pytest
